# æœ¬åœ°é‡å®šå‘åŠŸèƒ½æµ‹è¯•æŒ‡å—

## åŠŸèƒ½è¯´æ˜

åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­ï¼Œè®¿é—®çŸ­é“¾æ¥æ—¶ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°ç›®æ ‡ URLã€‚

## å·¥ä½œåŸç†

### æœ¬åœ°å¼€å‘ç¯å¢ƒ
1. ç”¨æˆ·è®¿é—®çŸ­é“¾æ¥ï¼ˆå¦‚ `http://localhost:5173/ltdgteq`ï¼‰
2. Vite å¼€å‘æœåŠ¡å™¨è¿”å› `index.html`
3. React åº”ç”¨å¯åŠ¨ï¼Œ`App.tsx` ä¸­çš„ `useEffect` æ£€æµ‹åˆ°è·¯å¾„ä¸æ˜¯æ ¹è·¯å¾„
4. ä» `localStorage` è¯»å–å†å²è®°å½•ï¼ŒæŸ¥æ‰¾åŒ¹é…çš„ slug
5. å¦‚æœæ‰¾åˆ°ï¼Œæ‰§è¡Œ `window.location.href = link.url` é‡å®šå‘åˆ°ç›®æ ‡ URL
6. å¦‚æœæœªæ‰¾åˆ°ï¼Œä½¿ç”¨ `window.history.pushState` è¿”å›é¦–é¡µ

### ç”Ÿäº§ç¯å¢ƒï¼ˆCloudflare Pagesï¼‰
1. ç”¨æˆ·è®¿é—®çŸ­é“¾æ¥ï¼ˆå¦‚ `https://your-domain.com/ltdgteq`ï¼‰
2. Cloudflare Pages æ ¹æ® `_routes.json` é…ç½®ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ° `functions/[slug].ts`
3. Functions æŸ¥è¯¢ D1 æ•°æ®åº“
4. è¿”å› HTTP 301 é‡å®šå‘åˆ°ç›®æ ‡ URL
5. æµè§ˆå™¨è‡ªåŠ¨è·³è½¬

## æµ‹è¯•æ­¥éª¤

### 1. å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

### 2. æ‰“å¼€æµè§ˆå™¨
è®¿é—® http://localhost:5173/

### 3. ç”ŸæˆçŸ­é“¾æ¥
è¾“å…¥ä¸€ä¸ªé•¿ URLï¼Œä¾‹å¦‚ï¼š
```
https://edgeone.ai/pages/new?repository-url=https://github.com/x-dr/short
```

ç‚¹å‡»"ç”ŸæˆçŸ­é“¾æ¥"ï¼Œä¼šå¾—åˆ°ç±»ä¼¼ï¼š
```
http://localhost:5173/ltdgteq
```

### 4. æµ‹è¯•é‡å®šå‘
åœ¨æ–°æ ‡ç­¾é¡µä¸­è®¿é—®ç”Ÿæˆçš„çŸ­é“¾æ¥ï¼š
```
http://localhost:5173/ltdgteq
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… é¡µé¢æ˜¾ç¤º"æ­£åœ¨é‡å®šå‘..."åŠ è½½åŠ¨ç”»
- âœ… è‡ªåŠ¨è·³è½¬åˆ°ç›®æ ‡ URLï¼ˆedgeone.aiï¼‰
- âœ… æµè§ˆå™¨åœ°å€æ æ˜¾ç¤ºç›®æ ‡ URL

**å¦‚æœæœªé‡å®šå‘**ï¼š
- âŒ æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
- âŒ ç¡®è®¤ localStorage ä¸­æœ‰è¯¥çŸ­é“¾æ¥è®°å½•
- âŒ åˆ·æ–°é¡µé¢é‡è¯•

### 5. æµ‹è¯•ä¸å­˜åœ¨çš„çŸ­é“¾æ¥
è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„çŸ­é“¾æ¥ï¼š
```
http://localhost:5173/notexist
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… è‡ªåŠ¨è¿”å›é¦–é¡µ
- âœ… åœ°å€æ æ˜¾ç¤º `http://localhost:5173/`

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ localStorage
åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
JSON.parse(localStorage.getItem('recentLinks'))
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
```json
[
  {
    "slug": "ltdgteq",
    "shortUrl": "http://localhost:5173/ltdgteq",
    "url": "https://edgeone.ai/pages/new?repository-url=https://github.com/x-dr/short"
  }
]
```

### æ¸…é™¤å†å²è®°å½•
å¦‚æœéœ€è¦æ¸…é™¤æµ‹è¯•æ•°æ®ï¼š
```javascript
localStorage.removeItem('recentLinks')
```

### æ‰‹åŠ¨æ·»åŠ æµ‹è¯•æ•°æ®
```javascript
localStorage.setItem('recentLinks', JSON.stringify([
  {
    slug: 'test123',
    shortUrl: 'http://localhost:5173/test123',
    url: 'https://www.example.com'
  }
]))
```

ç„¶åè®¿é—® `http://localhost:5173/test123` æµ‹è¯•é‡å®šå‘ã€‚

## é™åˆ¶è¯´æ˜

### æœ¬åœ°å¼€å‘ç¯å¢ƒ
- âš ï¸ **ä»…æ”¯æŒå½“å‰æµè§ˆå™¨ç”Ÿæˆçš„çŸ­é“¾æ¥**
  - çŸ­é“¾æ¥æ•°æ®å­˜å‚¨åœ¨ localStorage
  - å…¶ä»–æµè§ˆå™¨æˆ–è®¾å¤‡æ— æ³•è®¿é—®
  - æ¸…é™¤æµè§ˆå™¨æ•°æ®ä¼šä¸¢å¤±è®°å½•

- âš ï¸ **æ— æ³•æµ‹è¯•æ•°æ®åº“åŠŸèƒ½**
  - ä¸ä¼šä¿å­˜åˆ° D1 æ•°æ®åº“
  - ä¸ä¼šæ›´æ–°ç‚¹å‡»ç»Ÿè®¡
  - ä¸æ”¯æŒé™æ€å¯¼å‡º

### ç”Ÿäº§ç¯å¢ƒï¼ˆCloudflare Pagesï¼‰
- âœ… **å®Œæ•´åŠŸèƒ½æ”¯æŒ**
  - çŸ­é“¾æ¥å­˜å‚¨åœ¨ D1 æ•°æ®åº“
  - æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®
  - æ”¯æŒç‚¹å‡»ç»Ÿè®¡
  - æ”¯æŒé™æ€å¯¼å‡º
  - æ”¯æŒè¾¹ç¼˜ç¼“å­˜

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæœ¬åœ°å¼€å‘åªèƒ½è®¿é—®è‡ªå·±ç”Ÿæˆçš„çŸ­é“¾æ¥ï¼Ÿ
A: æœ¬åœ°å¼€å‘ä½¿ç”¨ localStorage å­˜å‚¨ï¼Œæ•°æ®ä»…åœ¨å½“å‰æµè§ˆå™¨å¯ç”¨ã€‚ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ D1 æ•°æ®åº“ï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº«ã€‚

### Q: å¦‚ä½•æµ‹è¯•å®Œæ•´çš„æ•°æ®åº“åŠŸèƒ½ï¼Ÿ
A: éœ€è¦éƒ¨ç½²åˆ° Cloudflare Pagesã€‚æœ¬åœ°å¼€å‘ä¸»è¦ç”¨äºæµ‹è¯• UI å’Œäº¤äº’é€»è¾‘ã€‚

### Q: é‡å®šå‘é€Ÿåº¦æ…¢ï¼Ÿ
A: æœ¬åœ°å¼€å‘çš„é‡å®šå‘æ˜¯å®¢æˆ·ç«¯æ‰§è¡Œçš„ï¼Œä¼šæœ‰çŸ­æš‚å»¶è¿Ÿã€‚ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æœåŠ¡å™¨ç«¯ 301 é‡å®šå‘ï¼Œé€Ÿåº¦æ›´å¿«ã€‚

### Q: å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨ wrangler æµ‹è¯•å®Œæ•´åŠŸèƒ½å—ï¼Ÿ
A: å¯ä»¥ï¼Œä½†éœ€è¦é¢å¤–é…ç½®ï¼š
```bash
npm run build:frontend
npx wrangler pages dev dist --d1=DB --port=8788
```

## ä»£ç å®ç°

é‡å®šå‘é€»è¾‘åœ¨ `src/App.tsx` ä¸­ï¼š

```typescript
useEffect(() => {
  const path = window.location.pathname.slice(1)

  if (!path || path.startsWith('api/')) {
    return
  }

  const history = JSON.parse(localStorage.getItem('recentLinks') || '[]')
  const link = history.find(l => l.slug === path)

  if (link) {
    setIsRedirecting(true)
    window.location.href = link.url
  } else {
    window.history.pushState({}, '', '/')
  }
}, [])
```

## ä¸‹ä¸€æ­¥

1. âœ… æœ¬åœ°æµ‹è¯•é‡å®šå‘åŠŸèƒ½
2. âœ… ç¡®è®¤åŠŸèƒ½æ­£å¸¸
3. ğŸ“¤ æ¨é€ä»£ç åˆ° GitHub
4. ğŸš€ éƒ¨ç½²åˆ° Cloudflare Pages
5. ğŸ§ª æµ‹è¯•ç”Ÿäº§ç¯å¢ƒçš„å®Œæ•´åŠŸèƒ½
